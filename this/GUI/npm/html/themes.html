<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>this.GUI — Runtime</title>
<link rel="icon" href="https://res.cloudinary.com/dkwnxf6gm/image/upload/v1761276578/this.gui.npm.png" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/this.gui@latest/dist/this.gui.css" />
<style>
  /* Improve legibility when the Hero background image is used */
  body { margin: 0; }
  #root { min-height: 100vh; }
  .onboard-shadow {
    text-shadow: 0 2px 14px rgba(0,0,0,0.55);
  }
</style>
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/react@18/umd/react-jsx-runtime.production.min.js"></script>
<script src="https://unpkg.com/react-router@6/umd/react-router.production.min.js"></script>
<script src="https://unpkg.com/react-router-dom@6/umd/react-router-dom.production.min.js"></script>
<script>
  window.process = {
    env: {
      NODE_ENV: "production"
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/this.gui@latest/dist/this.gui.umd.js"></script>
<script>
  (function () {
    const GUI = window.GUI;
    const GUI_VERSION =
      GUI?.version ||
      GUI?.VERSION ||
      GUI?.__version ||
      GUI?.__VERSION__ ||
      GUI?.default?.version ||
      GUI?.default?.VERSION ||
      null;

    const CDN_VERSION = (() => {
      try {
        const urls = [];
        document.querySelectorAll('script[src]').forEach((s) => urls.push(s.src));
        document.querySelectorAll('link[href]').forEach((l) => urls.push(l.href));
        for (const url of urls) {
          const m = url.match(/\/npm\/this\.gui@([^/]+)\//);
          if (m && m[1]) return m[1];
        }
      } catch (e) {}
      return null;
    })();

    const RESOLVED_VERSION =
      GUI_VERSION || (CDN_VERSION && CDN_VERSION !== 'latest' ? CDN_VERSION : null);
    // For @latest: resolve actual version via jsDelivr metadata API.
    let LATEST_RESOLVED_VERSION = null;
    const resolveLatestFromJsDelivr = async () => {
      try {
        const r = await fetch('https://data.jsdelivr.com/v1/package/npm/this.gui');
        if (!r.ok) return null;
        const j = await r.json();
        return j?.tags?.latest || j?.version || null;
      } catch (e) {
        return null;
      }
    };

    // Compute the label shown in UI.
    let VERSION_LABEL = RESOLVED_VERSION
      ? RESOLVED_VERSION
      : CDN_VERSION === 'latest'
        ? 'latest (resolving…)'
        : 'unknown';

    // Show version in the tab title for quick confirmation.
    try {
      document.title = RESOLVED_VERSION ? `.GUI v${RESOLVED_VERSION}` : `.GUI (${VERSION_LABEL})`;
    } catch (e) {}

    if (!GUI) {
      console.error('[GUI] window.GUI not found. UMD bundle may not be exposing correctly.');
      const rootEl = document.getElementById('root');
      if (rootEl) rootEl.innerHTML = '<div style="font-family:sans-serif;padding:24px;">❌ window.GUI not found</div>';
      return;
    }

    const rootEl = document.getElementById('root');
    if (!rootEl) {
      console.warn('[GUI] Root element not found.');
      return;
    }

    // Resolve common exports.
    const GuiProvider = GUI.GuiProvider || GUI.GuiProvider?.default || GUI.default?.GuiProvider;
    const Hero = GUI.Hero || GUI.molecules?.Hero || GUI.molecules?.Hero2 || GUI.default?.Hero || GUI.default?.Hero2;
    const Box = GUI.Box || GUI.atoms?.Box || GUI.default?.atoms?.Box;
    // Layout (ResponsiveUI shell) — optional.
    const Layout =
      GUI.Layout ||
      GUI.default?.Layout ||
      GUI.Theme?.Layout ||
      GUI.default?.Theme?.Layout ||
      null;

    // Themes catalog UI — optional.
    const ThemesCatalog =
      GUI.ThemesCatalog ||
      GUI.Catalog ||
      GUI.Theme?.ThemesCatalog ||
      GUI.Theme?.Catalog ||
      GUI.organisms?.ThemesCatalog ||
      GUI.organisms?.Catalog ||
      GUI.molecules?.ThemesCatalog ||
      GUI.molecules?.Catalog ||
      GUI.default?.ThemesCatalog ||
      GUI.default?.Catalog ||
      null;

    // Basic fallback wrapper (no dependency on MUI components being present).
    function FallbackShell(props) {
      return React.createElement(
        'div',
        {
          style: {
            minHeight: '100vh',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '24px',
            fontFamily: 'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif',
            background: '#0b1220',
            color: 'white',
          },
        },
        props.children
      );
    }

    // Render Themes catalog component as the page content.
    // Wrap in a page container so content has perimeter spacing even inside Layout.
    const pageBody = ThemesCatalog
      ? React.createElement(
          'div',
          {
            style: {
              width: '100%',
              boxSizing: 'border-box',
              padding: '24px',
            },
          },
          React.createElement(
            'div',
            {
              style: {
                width: '100%',
                maxWidth: 1200,
                margin: '0 auto',
              },
            },
            React.createElement(ThemesCatalog, {
              title: 'Themes',
              subtitle: 'This.GUI theme catalog',
              kind: 'themes',
              items: [
                { id: 'princeOfDarkness', label: 'Prince of Darkness' },
                { id: 'seaFoam', label: 'Sea Foam' },
                { id: 'ghost', label: 'Ghost' },
                { id: 'lunaHex', label: 'Luna Hex' },
                { id: 'cherryByte', label: 'Cherry Byte' },
              ],
            })
          )
        )
      : React.createElement('div', { style: { padding: '24px' } });
    // If Layout exists, render a ResponsiveUI shell with a LeftSidebar.
    // NOTE: Layout stories show it accepts `leftSidebarConfig` and `topBarConfig`.
    const pageWithLayout = Layout
      ? React.createElement(
          Layout,
          {
            leftSidebarConfig: {
              initialView: 'rail',
              elements: [
                { type: 'link', props: { label: 'Home', icon: 'home', href: '../../index.html' } },
                { type: 'link', props: { label: '.GUI', icon: 'widgets', href: './index.html' } },
                { type: 'link', props: { label: 'Themes', icon: 'palette', href: './themes.html' } },
                { type: 'link', props: { label: 'Exports', icon: 'schema', href: './exports.html',}},
                { type: 'link', props: { label: 'Storybook', icon: 'auto_stories', href: 'https://neurons-me.github.io/storybook-static/' } },
                { type: 'link', props: { label: 'GitHub', icon: 'code', href: 'https://github.com/neurons-me/this.GUI' } },
                { type: 'link', props: { label: 'npm', icon: 'package_2', href: 'https://www.npmjs.com/package/this.gui' } }
              ]
            },
            // Many Layout implementations render their own content region; we also pass children
            // so it works if Layout supports `props.children`.
            children: pageBody,
          }
        )
      : pageBody;

    const App = GuiProvider
      ? React.createElement(GuiProvider, { theme: 'dark' }, pageWithLayout)
      : React.createElement(FallbackShell, null, pageWithLayout);
    const root = ReactDOM.createRoot(rootEl);
    root.render(App);
    console.log('[GUI] ✅ Standalone render complete.');
    // If using @latest and the bundle doesn't expose a version, resolve it via jsDelivr API and update the label.
    (async () => {
      if (RESOLVED_VERSION || CDN_VERSION !== 'latest') return;
      const v = await resolveLatestFromJsDelivr();
      if (!v) {
        VERSION_LABEL = 'latest (unknown)';
      } else {
        LATEST_RESOLVED_VERSION = v;
        VERSION_LABEL = v;
        try {
          document.title = `.GUI v${v}`;
        } catch (e) {}
      }

      const el = document.getElementById('version-line');
      if (el) el.textContent = 'CDN Version: ' + VERSION_LABEL;

      console.log('[GUI] Resolved @latest via jsDelivr API:', VERSION_LABEL);
    })();
  })();
</script>

</body>
</html>
